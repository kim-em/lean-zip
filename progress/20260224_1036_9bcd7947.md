# Progress: 2026-02-24 10:36 UTC

**Session**: 9bcd7947 (worker, review/file-organization)
**Issue**: #170 — Review: extract helper lemmas from DecodeCorrect.lean into DecodeHelpers.lean

## Accomplished

Extracted infrastructure lemmas from `DecodeCorrect.lean` into a new
`DecodeHelpers.lean` file:

- **Position/well-formedness invariants**: `decode_wf`, `readBit_pos_inv`,
  `readBits_go_pos_inv`, `readBits_pos_inv`, `decode_go_pos_inv`,
  `decode_pos_inv`, `readBits_go_wf`, `readBits_wf`
- **Table correspondence lemmas**: `lengthBase_eq`, `lengthExtra_eq`,
  `distBase_eq`, `distExtra_eq`, `lengthExtra_le_32`, `distExtra_le_32`,
  `spec_distBase_pos`, `getElem?_eq_some_getElem!`, `ba_getElem!_eq_toList`
- **Copy loop lemmas**: `push_getElem_lt`, `push_data_toList`,
  `copyLoop_spec`, `copyLoop_eq_ofFn`

Changed visibility from `private` to `protected` for cross-file access.
Updated all references in `DecodeCorrect.lean` to use fully-qualified names.

## Decisions

- The plan assumed DecodeCorrect.lean was 895 lines but it was actually
  1214 lines (the `decodeHuffman_complete` reference case was proved by
  a concurrent PR #178). The extraction still removed ~240 lines of
  helpers as planned, bringing it from 1214 to 1191 lines.
- The plan's "under 700 lines" target was based on stale line counts.
  The file is now 1191 lines — still manageable but not under 700.
  A future split of the completeness section (lines 469+) into a
  separate `DecodeComplete.lean` would bring it under 700.

## Metrics

- Sorry count: 4 → 4 (unchanged)
- DecodeCorrect.lean: 1214 → 1191 lines
- DecodeHelpers.lean: 261 lines (new)
- `lake build`: pass
- `lake exe test`: all tests pass
