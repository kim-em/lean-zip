# Progress: Split Huffman.lean

**Date**: 2026-02-23 ~12:00 UTC
**Session type**: review (file organization)
**Issue**: #42 — Review: Split Huffman.lean (914 lines)

## What was done

Split `Zip/Spec/Huffman.lean` (914 lines) into two files:

- **`Zip/Spec/Huffman.lean`** (172 lines): Core definitions and types — `Codeword`,
  `natToBits` + basic properties, `countLengths`, `nextCodes`, `codeFor`, `allCodes`,
  `isPrefixOf`, `decode`, `IsPrefixFree`, `ValidLengths`.

- **`Zip/Spec/HuffmanTheorems.lean`** (762 lines): All property theorems — Kraft
  inequality analysis, prefix-free proofs (`canonical_prefix_free`,
  `allCodeWords_prefix_free`), injectivity (`codeFor_injective`), decode correctness
  (`decode_prefix_free`), and connecting theorems (`allCodes_mem_iff`, `allCodes_nodup`).

Private helpers (`natToBits_append`, `natToBits_prefix_lt`, `IsPrefix_dichotomy`,
`isPrefixOf_self_append`) that were only used by the proof section were moved to
`HuffmanTheorems.lean`, keeping them `private` since all their consumers are in
the same file.

Updated imports:
- `Zip/Spec/Deflate.lean`: `import Zip.Spec.Huffman` → `import Zip.Spec.HuffmanTheorems`
- `Zip.lean`: Added `import Zip.Spec.HuffmanTheorems`
- `Zip/Native/Inflate.lean`: Unchanged (only uses definitions, not theorems)
- `Zip/Spec/HuffmanCorrect.lean`: Unchanged (gets `HuffmanTheorems` transitively via
  `BitstreamCorrect` → `Deflate` → `HuffmanTheorems`)

Updated `.claude/CLAUDE.md` source layout table.

## Verification

- `lake build`: passes (114 jobs)
- `lake exe test`: all tests pass
- Sorry count: 3 (unchanged, all in Deflate.lean)
- No theorem statements changed or removed

## Decisions

- Moved private helpers to `HuffmanTheorems.lean` rather than changing visibility to
  `protected`, since all consumers are proof theorems that also moved to the same file.
- Added a note in `Huffman.lean`'s module doc pointing to `HuffmanTheorems` for property
  theorems.
