# Progress: Split Deflate.lean suffix invariance

**Date**: 2026-02-24T13:21:20Z
**Session type**: review (file organization + proof quality)
**Issue**: #186

## Accomplished

- Split `Zip/Spec/Deflate.lean` (1495 lines) into:
  - `Zip/Spec/Deflate.lean` (883 lines) — core definitions, types, decode functions, stored block encode/decode roundtrip, fixed Huffman tables
  - `Zip/Spec/DeflateSuffix.lean` (611 lines) — suffix invariance theorems (`_append` and `decode_go_suffix`)
- Updated `Zip.lean` with new import
- Updated `.claude/CLAUDE.md` source layout table

## Proof quality improvements (4 improvements)

1. **Deduplicated `.literal`/`.reference` cases** in `decodeSymbols_append` — they were identical, merged into a single `| .literal _ | .reference .. =>` arm (saved 6 lines)
2. **Simplified `readBitsLSB_append` zero case** — replaced `simp at h ⊢; obtain; exact` with `simp_all`
3. **Simplified `readNBytes_append` zero case** — same pattern
4. **Simplified `readCLLengths_append` zero case** — same pattern

## Decisions

- No visibility changes needed — the suffix section only references public defs from the core section
- No other files needed import updates — suffix theorems are currently only used within DeflateSuffix.lean itself (cross-referenced internally)
- `allCodes_swapped_prefix_free` stays `private` in the new file since it's only used by other suffix theorems

## Verification

- `lake build`: pass
- `lake exe test`: pass (all tests passed)
- Sorry count: 2 (unchanged — both in DeflateDynamicCorrect.lean)
- Line counts: Deflate.lean 883, DeflateSuffix.lean 611
