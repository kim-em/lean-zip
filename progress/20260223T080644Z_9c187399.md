# Progress: 2026-02-23T08:06Z — Worker session 9c187399

## Session type
Implementation (worker, issue #37)

## What was accomplished
- Proved the reference (back-reference) case of `encodeLitLen_decodeLitLen`
  in `Zip/Spec/Deflate.lean`, eliminating one `sorry`
- Added 7 helper lemmas:
  - `readBitsLSB_writeBitsLSB` (local copy to avoid circular import)
  - `findLengthCode_go_spec` / `findLengthCode_spec`
  - `findDistCode_go_spec` / `findDistCode_spec`
  - `lengthTable_gap` / `distTable_gap`

## Key proof patterns discovered
- **`letFun` for `have` bindings in unfolded defs**: When `unfold f at h`
  leaves `have x := e; body` bindings that obstruct `split at h`, use
  `simp only [letFun] at h` to reduce them. The linter may report this as
  unused (false positive due to caching), but removing it breaks the proof.
- **`simp` (not `simp only`) for do-notation match chains**: After
  `unfold decodeLitLen`, the do-notation expands to nested
  `match opt?, fun val => ... with | none, _ => none | some a, f => f a`.
  `simp only` cannot enter these match expressions to rewrite inner terms.
  Use full `simp` with the relevant hypotheses to chain all steps at once.
- **`obtain ⟨_, h, rfl, _⟩` for substituting encoder variables**: When
  the encoder uses `extraN` and the decoder uses `lengthExtra[idx]`,
  destructure the spec lemma with `rfl` on the equality component to
  substitute the encoder variable everywhere, aligning both sides.
- **`if_neg` for decidable conditions**: To eliminate `if (257 + idx) == 256`
  in the unfolded decoder, use `rw [if_neg (show ¬((257 + idx == 256) = true)
  by simp [beq_iff_eq]; omega)]` rather than `simp only` with inline proofs.
- **Table gap lemmas via `decide` on `Fin`**: Properties like
  `∀ i : Fin 29, gap(i) ≤ 2^extra(i)` can be proved by `decide` since
  the universal is over a finite type. Don't introduce the variable first.

## Sorry count delta
- Start: 5 in Deflate.lean
- End: 4 in Deflate.lean
- Delta: -1

## What remains
- 4 sorrys in Deflate.lean:
  - `encodeStored_decode` (3 sorrys for stored block encoding roundtrip cases)
  - `encodeSymbols_decodeSymbols` (1 sorry for a cases branch)
