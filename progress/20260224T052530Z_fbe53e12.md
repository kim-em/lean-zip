# Progress: Split DeflateEncodeDynamic.lean

- **Date**: 2026-02-24 05:25 UTC
- **Session**: fbe53e12 (worker)
- **Issue**: #138

## What was done

Split `Zip/Spec/DeflateEncodeDynamic.lean` (1081 lines) into two files:

1. **DeflateEncodeDynamic.lean** (406 lines) — RLE types (`CLEntry`,
   `countRun`, `rlEncodeLengths`, `rlDecodeLengths`), roundtrip proof
   (`rlDecodeLengths_rlEncodeLengths`), entry validity proof
   (`rlEncodeLengths_valid`), and the dynamic block header encoder
   (`encodeDynamicTrees`).

2. **DeflateEncodeDynamicProps.lean** (692 lines) — All correspondence
   proofs connecting encoder to decoder: `readCLLengths_writeCLLengths`,
   `encodeCLEntries_decodeCLSymbols_go`,
   `readCLLengths_recovers_clLens`,
   `encodeDynamicTrees_decodeDynamicTables`.

Changed four `rlDecode_go_*` helper lemmas from `private` to
`protected` for cross-file access. Updated CLAUDE.md source layout
table with the new file entry.

## Decisions

- Split point at line 404 (after `encodeDynamicTrees`, before proof
  section) — natural boundary between definitions and proofs.
- Used `protected` (not public) for the helper lemmas to keep them
  somewhat encapsulated while allowing cross-file access.

## Review observations

- Proofs are well-structured; no significant improvement opportunities found.
- `rlDecodeLengths_go_mono` and `rlDecodeLengths_go_strict_mono` share
  error-handling code but extracting a helper wouldn't simplify much.
- Linter warnings about unused `letFun` in DeflateEncode.lean are known
  false positives per CLAUDE.md guidance.

## Metrics

- Sorry count: 11 (unchanged)
- Build: passes
- Tests: all pass
