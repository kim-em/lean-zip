# Progress: Review InflateCorrect + InflateComplete

**Date**: 2026-02-25T06:43Z
**Session type**: review
**Issue**: #271

## What was done

Reviewed both stream-level DEFLATE correctness files (323 + 527 lines):

### InflateCorrect.lean
- Reduced `maxRecDepth` from 4096 to 2048 on three sites (`fixedLitLengths_eq`,
  `fixedLitLengths_size`, `inflateLoop_correct`)
- Reduced `maxHeartbeats` from 4,000,000 to 2,000,000 on `fixedLitLengths_eq`
- Verified that `fixedDistLengths_eq` (maxRecDepth 2048) and
  `fixedDistLengths_size` (no maxRecDepth) are already minimal
- Bridge lemmas (`bfinal_beq_nat_true/false`, `nat_beq_to_uint32_true/false`)
  are cleanly written with appropriate visibility (`private` vs `protected`)
- The three block-type cases in `inflateLoop_correct` follow an identical
  bfinal split pattern — extracting a helper would obscure rather than
  clarify, since the block-specific hypotheses differ

### InflateComplete.lean
- Extracted inline `uint8_roundtrip` into named `uint8_nat_roundtrip`
  theorem in the helpers section (available for reuse in future proofs)
- Deduplicated `List.replicate 19 0` rewriting in `decodeDynamicTrees_complete`
  by hoisting to a local `have hrep19` before the `cases` split
- Reduced `maxRecDepth` from 4096 to 2048 on `inflateLoop_complete`
- The `set_option linter.unusedSimpArgs false` on line 88 is a necessary
  workaround for the `letFun` simp lemma — left as-is
- `validLengths_toUInt8_roundtrip` depends on `Huffman.Spec.ValidLengths`
  (project-specific), so not worth moving to ZipForStd

### Assessment
Both files are well-structured with clear proof organization. The main
improvement opportunities were reducing resource limits and eliminating
local code duplication. The proof architecture (correctness + completeness
as mirror proofs, with shared bridge lemmas) is sound. No dead code,
unused parameters, or missing lemmas found.

## Sorry count
- Before: 3 (1 GzipCorrect, 2 ZlibCorrect)
- After: 3 (unchanged)

## Files changed
- `Zip/Spec/InflateCorrect.lean` — reduced maxRecDepth/maxHeartbeats
- `Zip/Spec/InflateComplete.lean` — extracted lemma, deduplicated rewrite, reduced maxRecDepth
