# Progress: Native lz77Greedy validity (BB1 for native compressor)

**Date**: 2026-02-23T07:55Z
**Session**: f16682de (worker, implementation)
**Issue**: #47

## Accomplished

Created `Zip/Spec/LZ77NativeCorrect.lean` with the BB1 correctness framework
for the native LZ77 compressor:

### Definitions
- `LZ77Token.toLZ77Symbol`: converts native tokens to spec symbols
- `tokensToSymbols`: converts full token array with end-of-block marker
- `ValidDecomp`: inductive predicate for valid token decompositions of data

### Proved theorems
- `lz77Greedy.go_matches`: native `countMatch.go` correctly counts matching
  bytes (by induction on the recursive function, matching spec pattern)
- `lz77Greedy.countMatch_matches`: wrapper for `go_matches`
- `direct_match_implies_modular`: bridge lemma showing direct byte-by-byte
  match implies modular-copy match (used by `resolveLZ77`). Proved by strong
  induction on the index.
- `validDecomp_resolves_aux` / `validDecomp_resolves`: any valid decomposition
  resolves to the original data via `resolveLZ77`. Proved by induction on
  `ValidDecomp`, with `ByteArray`↔`List` conversion lemmas.
- `lz77Greedy_resolves`: main BB1 theorem (composition of `validDecomp_resolves`
  and `lz77Greedy_valid`)

### Stated with sorry (documented)
- `lz77Greedy_valid`: lz77Greedy produces a valid decomposition. Requires
  reasoning about `Id.run do` with mutable state and while loops.
- `lz77Greedy_encodable`: tokens have valid ranges for Huffman encoding.
  Same blocker.

## Key proof patterns
- `ByteArray.getElem!_toList`: bridging `data[i]!` to `data.data.toList[i]`
  requires `getElem!_pos` + `Array.getElem_toList` (two steps, not definitional)
- `List.getElem_take` has all implicit args — use `simp only [List.getElem_take]`
  not `rw [List.getElem_take (...)]`
- `min pos data.size` from `List.length_take` requires explicit
  `Nat.min_eq_left` when omega needs to reason about modular expressions

## Sorry count
- Before: 2 (Zip/Spec/Deflate.lean)
- After: 4 (+2 in Zip/Spec/LZ77NativeCorrect.lean: `lz77Greedy_valid`,
  `lz77Greedy_encodable` — both blocked on `Id.run do` loop reasoning)
