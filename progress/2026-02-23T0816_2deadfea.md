# Progress: Native gzip/zlib compression

**Date**: 2026-02-23 08:16 UTC
**Session**: 2deadfea (worker)
**Issue**: #54 — Native gzip/zlib compression using native DEFLATE + checksums

## What was accomplished

Added native gzip (RFC 1952) and zlib (RFC 1950) compression to
`Zip/Native/Gzip.lean`, completing the native compress/decompress
symmetry. All building blocks already existed — this wired them together.

### New functions
- `GzipEncode.compress`: 10-byte gzip header + native DEFLATE + CRC32/ISIZE trailer
- `ZlibEncode.compress`: CMF/FLG header (with correct FCHECK) + native DEFLATE + Adler32 trailer
- `compressAuto`: format-selecting convenience function (gzip/zlib/raw)

### Tests added (15 new tests in ZipTest/NativeGzip.lean)
- Native gzip roundtrip: level 0, level 1, empty, large (L0 + L1)
- Cross-implementation: native gzip compress → FFI decompress
- Native zlib roundtrip: level 0, level 1, empty
- Cross-implementation: native zlib compress → FFI decompress
- compressAuto roundtrip: gzip, zlib, raw deflate

## Verification
- `lake build`: pass
- `lake exe test`: all tests pass
- Sorry count: unchanged (2 in Spec/Deflate.lean, 2 in Spec/LZ77NativeCorrect.lean)
- `Zip/Native/Gzip.lean`: 215 lines (well under 500-line limit)

## Decisions
- Zlib header uses CMF=0x78 (CM=8, CINFO=7) with FCHECK computed to
  satisfy `(CMF*256 + FLG) % 31 == 0`. FLEVEL is 0x00 for level 0,
  0x40 for level 1.
- Gzip XFL byte: 0x02 for level 0 (fastest), 0x04 for level 1 (max compression).
  OS byte 0xFF (unknown) — matches common library behavior.
