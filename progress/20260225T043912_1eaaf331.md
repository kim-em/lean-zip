# Progress: Review HuffmanKraft.lean + HuffmanTheorems.lean

**Date**: 2026-02-25T04:39Z
**Session**: review (proof quality — Huffman characterizing properties)
**Issue**: #264

## What was accomplished

Reviewed HuffmanKraft.lean (365→335 lines) and HuffmanTheorems.lean (405→384 lines)
for proof quality. Focus: deduplication, proof minimization, and extracting reusable
lemmas to ZipForStd.

### Deduplication

- **Removed 3 private helpers** from HuffmanKraft.lean (`array_set_ne`,
  `array_set_self`, `array_set_size`) that duplicated public lemmas already
  in ZipForStd/Array.lean (`Array.getElem!_set!_ne`, `Array.getElem!_set!_self`).
  Added `Array.size_set!` to ZipForStd/Array.lean for the size preservation case.

- **Extracted `IsPrefix_dichotomy`** from HuffmanTheorems.lean into
  ZipForStd/List.lean as `List.IsPrefix_of_IsPrefix_append`. This is a general
  list property ("two prefixes of the same extension are comparable") with no
  connection to Huffman codes.

### Proof simplification

- `kraftSumFrom_replicate`: 6 lines → 3 (inline simp handles the replicate getElem)
- `countLengths_eq` replicate init: 3 lines → 1
- `countLengths_eq` skip branch: 8 lines → 4 (extract `l ≠ b` first, then simp)
- `kraftSumFrom_eq_kraft_foldl`: inlined `hfilt` intermediate variable

### What was NOT changed (and why)

- **`canonical_prefix_free`** (47 lines): The most important proof in the file.
  Well-structured with clear mathematical argument. Clarity over brevity — left as-is.
- **`decode_deterministic`**: Trivially `simp_all` but serves as a useful interface
  theorem with clear documentation. Kept.
- **`count_foldl_mono`**: Could theoretically move to ZipForStd but the expression
  is too Huffman-specific. Used in HuffmanTheorems + HuffmanCorrectLoop.
- **Private annotations**: All private helpers are intentionally private. None
  needed promotion.

## Decisions

- Changed HuffmanKraft import from `ZipForStd.List` to `ZipForStd.Array` (Array
  transitively imports List, so no functionality lost).
- Named the extracted prefix lemma `IsPrefix_of_IsPrefix_append` to match the
  standard library pattern for prefix/suffix lemma names.

## Sorry count

Unchanged: 3 (1 GzipCorrect, 2 ZlibCorrect). Target files: 0 sorries.

## Build/test status

Full build passes, all tests pass.
