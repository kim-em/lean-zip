# Progress: 2026-02-24T10:31:43Z — session 8be686d0

**Session type**: worker (review/file organization)
**Issue**: #170 — Extract helper lemmas from DecodeCorrect.lean into DecodeHelpers.lean

## What was accomplished

### PR #178 rebase (pre-work)
PR #178 had merge conflicts due to the squash merge of #177 onto master.
Rebased the branch using `git rebase --onto origin/master 3fc3ecc` to skip
the 2 commits already included in the squash merge, keeping only the 3 new
commits (decodeHuffman_complete proof + doc updates). Build and tests pass.

### Issue #170: DecodeHelpers extraction
Created `Zip/Spec/DecodeHelpers.lean` (260 lines) by extracting helper
infrastructure from `DecodeCorrect.lean`:

**Extracted lemmas (3 groups):**
1. Well-formedness/position invariants: `decode_wf`, `readBit_pos_inv`,
   `readBits_go_pos_inv`, `readBits_pos_inv`, `decode_go_pos_inv`,
   `decode_pos_inv`, `readBits_go_wf`, `readBits_wf`
2. Table correspondence: `lengthBase_eq`, `lengthExtra_eq`, `distBase_eq`,
   `distExtra_eq`, `lengthExtra_le_32`, `distExtra_le_32`,
   `spec_distBase_pos`, `getElem?_eq_some_getElem!`
3. Copy loop helpers: `ba_getElem!_eq_toList`, `push_getElem_lt`,
   `push_data_toList`, `copyLoop_spec`, `copyLoop_eq_ofFn`

**Visibility changes:**
- Internal-only helpers stayed `private` (e.g. `readBit_pos_inv`,
  `readBits_go_pos_inv`, `copyLoop_spec`)
- Cross-file helpers changed to `protected` (table correspondence lemmas,
  `getElem?_eq_some_getElem!`, `copyLoop_eq_ofFn`)
- Updated all references in DecodeCorrect.lean to use fully-qualified names

**File sizes:**
- DecodeCorrect.lean: 1432 → 1191 lines (241 lines removed)
- DecodeHelpers.lean: 260 lines (new)
- Note: DecodeCorrect.lean is still above 1000 lines because the
  completeness proofs (added in #177, #178) grew the file significantly
  since the plan was written. A further split (forward/completeness)
  would be a natural follow-up.

## Decisions
- Used `protected` (not public) for cross-file helpers to maintain
  namespace discipline — callers use fully-qualified names
- Kept the `/-! ## Huffman block correctness -/` section header in
  DecodeCorrect.lean since the main theorems remain there

## Verification
- `lake build` passes (156 jobs)
- `lake exe test` passes
- Sorry count unchanged: 4 (3 DeflateFixedCorrect, 1 InflateCorrect)
- No theorem statements modified
