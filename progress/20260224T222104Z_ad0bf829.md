# Progress: Review DeflateStoredCorrect.lean + PR #241 rebase

**Date**: 2026-02-24T22:21Z
**Session**: ad0bf829 (worker, review)
**Issue**: #235

## What was done

### PR #241 rebase (bonus)
- Rebased PR #241 onto master to resolve merge conflicts
- 6 of 10 commits were already upstream (via PR #239 squash merge)
- 4 remaining commits rebased cleanly

### DeflateStoredCorrect.lean review

**Deliverable 1: maxHeartbeats reduction**
- Removed all 6 `maxHeartbeats 800000` directives from the nonfinal proof chain
- All 6 proofs pass with default 200000 heartbeats (no optimization needed — the directives were simply unnecessary)
- The `fromLengths_fixedLit_ok` directive (1600000) was kept — `decide` on 288-element arrays is inherently expensive, and `decide_cbv` fails with simp max steps
- Result: 1 maxHeartbeats directive (down from 7)

**Deliverable 2: Proof deduplication**
- Moved 2 general ByteArray lemmas to ZipForStd/ByteArray.lean:
  - `extract_append_ge`: extract from `a ++ b` past `a.size`
  - `extract_append_left`: extracting 0..a.size from `a ++ b`
- Removed redundant `extract_zero_size` (duplicates stdlib `ByteArray.extract_zero_size`)
- Used stdlib `ByteArray.extract_append_extract` instead of local version
- Inlined 4 single-use private theorems:
  - `nonfinal_extract_block` (into `nonfinal_step_restructure`)
  - `nonfinal_reassoc` (into `nonfinal_step_restructure`)
  - `nonfinal_unfold_goal` (into `nonfinal_chain_first_half`)
  - `inflateLoop_deflateStored_nonfinal_fuel` (into `inflateLoop_deflateStored`)
- Result: 692 lines (down from 769), -114/+49 net change

## Decisions

- `decide_cbv` is not a viable replacement for `decide` on large arrays — it uses `simp` internally which hits max steps on the fixed Huffman code table (288 elements). Kept `maxHeartbeats 1600000` + `decide`.
- Linter `unusedSimpArgs` false positives on `bind, Except.bind` in inflateLoop proofs — these are needed to reduce do-notation but the linter doesn't detect the reduction. Kept `set_option linter.unusedSimpArgs false`.

## Metrics

| Metric | Before | After |
|--------|--------|-------|
| maxHeartbeats directives | 7 | 1 |
| File lines | 769 | 692 |
| Private helpers | ~19 | ~14 |
| Sorry count | 4 | 4 |
