# Progress: Decompose inflate_complete

**Date**: 2026-02-24 UTC
**Session**: 9bcd7947
**Type**: Implementation
**Issue**: #118

## Accomplished

Decomposed `inflate_complete` into independently-provable sub-lemma
statements, organized across three layers:

### 1. Bitstream layer (BitstreamCorrect.lean)
- `readBits_complete`: spec readBitsLSB → native readBits
- `readUInt16LE_complete`: spec readBitsLSB 16 after alignment → native readUInt16LE
- `readBytes_complete`: spec readNBytes → native readBytes

### 2. Block decode layer (DecodeCorrect.lean)
- `decodeStored_complete`: spec decodeStored → native decodeStored
- `huffTree_decode_complete`: spec Huffman.decode → native tree decode
- `decodeHuffman_complete`: spec decodeSymbols + resolveLZ77 → native decodeHuffman.go

### 3. Stream layer (InflateCorrect.lean)
- `decodeDynamicTrees_complete`: spec decodeDynamicTables → native decodeDynamicTrees
- `inflateLoop_complete`: spec decode.go → native inflateLoop

### 4. Top-level decomposition (DeflateFixedCorrect.lean)
- `inflate_complete` proof body now chains:
  `fromLengths_fixedLit_ok` + `fromLengths_fixedDist_ok` + `inflateLoop_complete`
- No raw `sorry` in `inflate_complete` — all sorry is now in sub-lemmas

## Sorry count
- Start: 8 (5 in DeflateFixedCorrect, 3 in DeflateEncodeDynamic)
- End: 15 (4 in DeflateFixedCorrect, 3 in DeflateEncodeDynamic,
  3 in BitstreamCorrect, 3 in DecodeCorrect, 2 in InflateCorrect)
- Net: +7 new sorries (intentional — decomposition trades 1 hard sorry
  for 8 smaller, independently-provable ones)

## Key decisions
- Fuel maps 1-to-1 between spec decode.go and native inflateLoop
  (both consume one fuel unit per block)
- Added `hbound : val < 2^n` precondition to `readBits_complete` —
  needed to reconstruct the UInt32 value faithfully
- Added `hmax : result.length ≤ maxOutputSize` precondition to
  completeness lemmas — needed because native checks output size
- Added import of DeflateStoredCorrect in DeflateFixedCorrect for
  `fromLengths_fixedLit_ok` / `fromLengths_fixedDist_ok`

## What remains
- Prove each sub-lemma (8 new sorry'd statements)
- The recommended order: readBits_complete → readUInt16LE_complete →
  readBytes_complete → decodeStored_complete → huffTree_decode_complete →
  decodeHuffman_complete → decodeDynamicTrees_complete → inflateLoop_complete
- Each sub-lemma can be proved independently by mirroring the
  corresponding forward-direction proof's structure
