# Progress: Zlib roundtrip proof (partial)

- **Date**: 2026-02-24T22:02Z
- **Session**: ad0bf829 (worker, issue #233)
- **Session type**: Implementation
- **Starting commit**: 1a5e64d

## What was done

### Deliverable 1: Prove zlib roundtrip (PARTIAL)

The proof of `zlib_decompressSingle_compress` is structurally complete with
two infrastructure-blocked `sorry`s remaining:

1. `hendPos_tight`: endPos + 4 ≤ compressed.size
2. `hadler`: Adler32 trailer byte match at endPos

Both require knowing endPos = 2 + deflated.size (that the inflate stops at
the start of the trailer). This is the same infrastructure needed for the
pre-existing `inflateLoop_endPos_le` sorry in GzipCorrect.lean.

### What's proven (no sorry)

- `inflate_to_spec_decode`: inflate → spec decode with fuel 10001
- `compress_eq`: compress = header(2) ++ deflateRaw ++ trailer(4)
- Spec decode at offset 2 via suffix invariance + prefix drop
- `inflateRaw_complete` application at offset 2
- All header guard discharges (size, checksum, CM, CINFO, FDICT)
- Full `decompressSingle` do-notation unfolding via maxRecDepth 8192

### Fuel bound strengthening

Strengthened `inflateLoop_correct` and `inflate_correct` in InflateCorrect.lean
to include `fuel ≤ 10001` in conclusion, needed for the inflate completeness
bridge.

## What was NOT completed

The two sorry's need inflateLoop endPos tracking infrastructure — a theorem
that inflateRaw on `prefix ++ deflated ++ suffix` at offset prefix.size
returns endPos ≤ prefix.size + deflated.size (or endPos = prefix.size +
deflated.size). This would also unblock gzip_decompressSingle_compress and
inflateLoop_endPos_le. Needs a new issue.

## Sorry count

- Start: 3 (GzipCorrect: 2, ZlibCorrect: 1)
- End: 4 (GzipCorrect: 2, ZlibCorrect: 2)
- Net: +1 (replaced 1 whole-theorem sorry with proof containing 2 targeted sorry's)
