# Progress: Review DeflateEncodeDynamicProps.lean + update PROGRESS.md

- **Date**: 2026-02-24T13:05Z
- **Session type**: review (proof quality + documentation)
- **Issue**: #183

## Accomplished

### Reviewed DeflateEncodeDynamicProps.lean (701 lines)

Systematic review of the dynamic block header correspondence proofs.

**Improvements applied (5):**

1. **Extracted `rlDecodeLengths_go_invalid_code`** helper lemma — deduplicates
   the identical exfalso/contradiction blocks that appeared in 3 separate
   theorems (`rlDecodeLengths_go_mono`, `rlDecodeLengths_go_strict_mono`,
   `rlDecodeLengths_go_entries_le_result`). Each had a 6-line block proving
   that codes outside {0..15, 16, 17, 18} make `rlDecodeLengths.go` return
   `none`.

2. **Moved `foldl_set_length`, `foldl_set_getElem_not_mem`,
   `foldl_set_getElem_mem`** to `ZipForStd/List.lean` — these are
   general-purpose lemmas about `List.foldl` with `List.set` operations,
   with no DEFLATE-specific logic. Candidates for upstreaming.

3. **Removed duplicate `htw_prefix`** hypothesis in
   `computeHCLEN_trailing_zero` (defined on both line 384 and 393).

4. **Fixed 10 unused simp argument linter warnings** in the main
   `encodeDynamicTrees_decodeDynamicTables` theorem — removed `guard`,
   `pure`, `Pure.pure`, `bind`, `Option.bind` from simp calls where
   the linter confirmed they were unused.

5. **Net reduction: 701 → 650 lines (-7.3%)**

### Reviewed visibility

All `private` helpers are correctly file-internal — only the public
theorems (`computeHCLEN_ge_four`, `computeHCLEN_le_nineteen`,
`readCLLengths_writeCLLengths`, `encodeDynamicTrees_decodeDynamicTables`)
are referenced by `DeflateDynamicCorrect.lean`.

### Updated PROGRESS.md

- Sorry count: corrected to 2 (both in DeflateDynamicCorrect.lean)
- Session count: ~100 → ~120
- Remaining sorries: updated with specific theorem names and sub-goal
  dependencies (`writeDynamicHeader_spec`, `computeCodeLengths_nonzero`)

## Decisions

- Kept `clPermutation_contains_all` proof as-is (simp + omega is already
  idiomatic for parametric membership in concrete lists)
- Did not attempt to merge `rlDecodeLengths_go_mono` and
  `rlDecodeLengths_go_entries_le_result` into one proof — they have the
  same induction skeleton but sufficiently different conclusions that
  merging would add complexity without clarity

## Sorry count

- Start: 2 (DeflateDynamicCorrect.lean)
- End: 2 (DeflateDynamicCorrect.lean)
- Delta: 0
