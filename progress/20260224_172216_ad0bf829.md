# Progress: Review + split Deflate.lean fuel-independence section

- **Date**: 2026-02-24 17:22 UTC
- **Session type**: review (proof quality + file organization)
- **Issue**: #203

## What was accomplished

### Deliverable 1: Extract fuel-independence theorems ✅
Moved 5 theorems from `Deflate.lean` into new `Zip/Spec/DeflateFuelIndep.lean`:
- `decodeSymbols_fuel_independent`
- `decodeCLSymbols_fuel_independent`
- `decode_go_fuel_independent` (private)
- `decode_go_acc_prefix`
- `decode_fuel_independent`

Import chain: `DeflateFuelIndep` imports `Deflate`. Added import to
`InflateComplete.lean` (the only cross-file user of `decode_go_acc_prefix`).

Result: Deflate.lean 883→630 lines, DeflateFuelIndep.lean 268 lines.

### Deliverable 2: Proof quality review of fuel-independence proofs ✅
- Reduced `maxRecDepth` from 4096 to 2048 for both `decode_go_fuel_independent`
  and `decode_go_acc_prefix` — the lower bound works after the split.
- Investigated deduplication of btype 1/2 case structure: the shared tail is
  only 2-3 lines per instance, making a helper lemma net-negative for
  readability. No change needed.

### Deliverable 3: Review stored block roundtrip section ✅
- `mod_two_mul`: Attempted simplification with `omega`, `grind`, `nlinarith` —
  none can handle the modular arithmetic with multiplication. The existing
  `calc` proof using `Nat.div_add_mod` + `Nat.mul_add_mod_of_lt` is already
  the minimal approach. No change.
- `readBitsLSB_ofFn_testBit`: Induction proof with careful testBit shift
  alignment. Already concise at 17 lines. No change.
- `encodeStored_go`: The `change` step is structurally necessary (simp
  cons-ifies `List.replicate`). No simplification found.
- Private helpers: Verified none are needed cross-file — all 7 private
  helpers are only used within `Deflate.lean`.
- `fixedLitLengths_valid`: Confirmed `maxRecDepth 2048` is needed for
  the `decide` on the Kraft inequality with 288 symbols.

## Sorry count
- Start: 0
- End: 0
- Delta: 0

## Commits
1. `c6eaf58` refactor: extract fuel-independence theorems into DeflateFuelIndep.lean
2. `09bfb49` refactor: reduce maxRecDepth from 4096 to 2048 in fuel-independence proofs
3. `59a8007` doc: add DeflateFuelIndep.lean to source layout table
