# Progress: Prove encodeDynamicTrees_decodeDynamicTables

- **Date**: 2026-02-24 04:27 UTC
- **Session type**: Worker (implementation)
- **Issue**: #125

## Accomplished

Proved `encodeDynamicTrees_decodeDynamicTables` — the main roundtrip
theorem for dynamic Huffman tree header encoding/decoding. This
eliminates the last sorry in `DeflateEncodeDynamic.lean`.

### Changes

1. **`Zip/Spec/Deflate.lean`**: Fixed off-by-one in `decodeDynamicTables`
   fuel — changed from `totalCodes` to `totalCodes + 1`. The previous
   fuel was insufficient when all CL entries are literals (no RLE
   compression), because `encodeCLEntries_decodeCLSymbols_go` requires
   fuel ≥ entries.length + 1 and entries.length can equal totalCodes.

2. **`Zip/Spec/DeflateEncodeDynamic.lean`**:
   - Added `rlDecodeLengths_go_entries_le_result` helper proving that
     the number of RLE entries is bounded by the decoded result length
   - Proved `encodeDynamicTrees_decodeDynamicTables` by chaining:
     readBitsLSB roundtrips (HLIT/HDIST/HCLEN), readCLLengths roundtrip,
     decodeCLSymbols roundtrip, and take/drop split

3. **`Zip/Spec/DynamicTreesCorrect.lean`**: Bridged the fuel change
   using `decodeCLSymbols_fuel_independent`

## Decisions

- The fuel fix is a genuine spec bug, not a proof convenience change.
  The previous fuel=totalCodes could fail for inputs where RLE doesn't
  compress at all (every CL symbol is a literal 0-15).

## Key patterns

- `let` bindings in Lean are definitionally equal but often opaque to
  `simp` and `omega`. Use explicit `have` to expose the equality, or
  `change` for omega.
- Lambda form mismatch (`fun x => (x.snd, x.fst)` vs
  `fun (sym, cw) => (cw, sym)`) resolved with `rw [show ... = name from rfl]`.

## Sorry count

- Start: 13
- End: 12 (−1)
- `DeflateEncodeDynamic.lean`: 1 → 0

## What remains

Nothing — all deliverables from issue #125 are complete.
