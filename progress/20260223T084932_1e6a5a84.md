# Progress: Spec-level lazy LZ77 matcher and Level 2 roundtrip

**Date**: 2026-02-23T08:49 UTC
**Session**: 1e6a5a84 (worker, implementation)
**Issue**: #61

## Accomplished

Implemented the spec-level lazy LZ77 matcher (`matchLZ77Lazy`) and proved the
full Level 2 roundtrip theorem (`deflateLevel2_spec_roundtrip`).

### New definitions
- `matchLZ77Lazy` / `matchLZ77Lazy.go` — lazy LZ77 matching (Level 2): at each
  position, finds longest match M1, then checks position + 1 for a longer M2.
  If M2 > M1, emits literal + M2 instead of M1.

### New theorems
- `findLongestMatch_end_le` — match doesn't extend past data (reusable helper)
- `resolveLZ77_findMatch_step` — resolving a reference from findLongestMatch
  advances accumulator correctly (reusable helper)
- `resolveLZ77_matchLZ77Lazy` — BB1 correctness for lazy matching
- `matchLZ77Lazy_validSymbolList` — valid symbol list
- `matchLZ77Lazy_encodable` — all symbols encodable with fixed Huffman
- `matchLZ77Lazy_length_le` — bound of 2 * data.length + 1 symbols
- `deflateLevel2_spec_roundtrip` — end-to-end Level 2 roundtrip

### Key decisions
- Extracted `findLongestMatch_end_le` and `resolveLZ77_findMatch_step` as
  reusable helpers. The `resolveLZ77_findMatch_step` helper eliminated ~60 lines
  of duplicated reference-step proof logic across 4 branches.
- Kept `if len1 < 3` guard in definition even though `findLongestMatch` guarantees
  len ≥ 3 — needed for the termination checker to see len1 ≥ 3 in the else branch.
- ValidSymbolList, length_le, encodable, and roundtrip proofs placed in
  DeflateEncode.lean (which imports Deflate.lean where ValidSymbolList is defined).
- Used 2 * data.length + 1 bound (not tighter) since lazy matching can emit
  literal + reference for one position. Sufficient for fuel constraint.

## Verification
- `lake build` ✓ (all 118 jobs)
- `lake exe test` ✓ (all tests passed)
- Sorry count: 4 (unchanged — 2 in Deflate.lean, 2 in LZ77NativeCorrect.lean)
- No existing theorems modified

## File sizes
- `Zip/Spec/LZ77.lean`: 576 lines (was 442, +134)
- `Zip/Spec/DeflateEncode.lean`: 726 lines (was 534, +192)
