# Progress: Review DynamicTreesCorrect.lean

- **Date**: 2026-03-01T13:08Z
- **Session type**: review
- **Issue**: #315

## What was accomplished

Reviewed and improved proof quality in `Zip/Spec/DynamicTreesCorrect.lean` (695 lines, 0 sorries).

### Changes applied

1. **`dsimp` for definitional unfolding** (8 occurrences): Replaced `simp only [bind, Except.bind]` and `simp only [pure, Except.pure]` with `dsimp only` variants. These unfold reducible definitions and are faster than full `simp`.

2. **`simpa` for combined simp+exact** (3 occurrences): Replaced `simp only [...] at hspec_rec ⊢; exact hspec_rec` with `simpa only [...] using hspec_rec` in the three RLE symbol cases (sym==16, 17, 18).

3. **Term-mode `▸` for bridge proofs** (2 occurrences): Replaced 10-line `hlit_vl`/`hdist_vl` have-blocks with 2-line `hlit_take ▸ hlit_valid` / `hdist_drop ▸ hdist_valid`.

4. **`all_goals` for duplicate subgoals**: Merged identical lit/dist length size bound proofs (8 lines → 4 lines).

5. **`simp` → `simp only`** (1 occurrence): Line 331 changed from bare `simp` to explicit `simp only [Except.ok.injEq, Prod.mk.injEq]`.

### Decisions

- Did NOT remove `have hsym_nat` / `have hsym_nat_ge` aliases: The `rename_i` hypotheses have a type that `simp only` cannot use directly (likely `decide` wrapper). The aliases provide the unwrapped `Nat` comparison.
- Did NOT extract a helper for sym==17/sym==18 cases: While structurally similar (differing only in readBits width and fill count), the cases are clearer as parallel inline proofs in this complex domain.
- Did NOT change `simp only [bind, Option.bind, ...]` to `dsimp` when mixed with hypothesis rewrites.

## Quality metrics

| Metric | Before | After |
|--------|--------|-------|
| Lines | 695 | 681 |
| Sorries | 0 | 0 |
| maxRecDepth | none | none |
| maxHeartbeats | none | none |
| Linter suppressions | none | none |

## Patterns worth noting

- `hlit_take ▸ hlit_valid` term-mode rewriting is a useful pattern for bridging between equivalent representations without verbose `have` blocks. Could apply to similar bridge proofs in other correctness files.
